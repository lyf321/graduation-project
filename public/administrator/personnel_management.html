<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <title>personnel management</title>
</head>
<style>
    body {
        font-family: 'lato' !important;
        background-color: white;
    }

    /*navbar start*/

    @media (min-width: 768px) {

        body {
            margin-top: 50px;
        }
    }

    #wrapper {
        padding-left: 0;
    }

    #page-wrapper {
        width: 100%;
        padding: 0;
    }

    /* Side Navigation */

    @media (min-width: 768px) {

        #wrapper {
            padding-left: 225px;
        }

        #page-wrapper {
            padding: 2px 10px;
        }

        .side-nav {
            position: fixed;
            top: -21px;
            left: 225px;
            width: 225px;
            margin-left: -225px;
            border: none;
            border-radius: 0;
            overflow-y: auto;
            background-color: #313131;
            bottom: 0;
            overflow-x: hidden;
            padding-bottom: 40px;
            margin-top: 20px;
        }

        .side-nav > li > a {
            width: 225px;
            border-bottom: 1px solid #6C7278;
            margin-top: 15px;
        }
    }

    .navbar-inverse .navbar-collapse, .navbar-inverse .navbar-form {
        border-color: #616060 !important;
    }

    .navbar-ex1-collapse {
        background-color: #fff;
    }

    .logostyle {
        width: 50%;
        max-width: 186px;
        margin-top: 10px;
        margin-left: 55px;
    }

    .navbar-inverse .navbar-nav > li > .active {
        border-left: 3px solid white;
    }

    .nav > li > a {
        position: relative;
        display: block;
        padding: 12px 15px;
        margin-right: 15px;
    }

    .nav .open > a, .nav .open > a:focus, .nav .open > a:hover {
        background-color: transparent;
        border-color: white;
    }

    a {
        color: white !important;
        text-decoration: none;
    }

    .form-control-serch {
        height: 32px;
        padding: 0px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        color: #555;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ccc;
        border-radius: 0px 22px 22px 0px;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
        transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    }

    .search-btn-icon {
        background-color: #fff;
        border: 1px solid #E8E8E8;
        border-right: transparent !important;
        border-top-left-radius: 30px;
        border-bottom-left-radius: 30px;
        height: 32px;
        margin-left: 200px;
    }

    .search-box {
        border-left: transparent !important;
        border-top-right-radius: 30px;
        border-bottom-right-radius: 30px;
        border: 1px solid #E8E8E8;
        height: 32px;
    }

    .fasett {
        display: inline-block;
        font: normal normal normal 14px/1 FontAwesome;
        font-size: 25px;
        text-rendering: auto;
        color: white;
        margin-top: 10px;
        margin-right: 30px;
        cursor: pointer;
    }

    a:hover {
        background-color: transparent !important;
    }

    .editpro h5 {
        margin-right: 15px;
        margin-top: 15px;
        color: white;
    }

    /*navbar end*/
    @media screen and (max-device-width: 640px) {

        .search-btn-icon {
            background-color: #fff;
            border: 1px solid #E8E8E8;
            border-right: transparent !important;
            border-top-left-radius: 30px;
            border-bottom-left-radius: 30px;
            height: 32px;
            margin-left: 115px;
        }

        .editpro h5 {
            margin-right: 12px;
            margin-top: 15px;
            color: white;
            margin-left: 158px;
        }

        .dashhead h1 {
            margin-top: 180px;
        }
    }

    #course_list {
        margin-left: 50px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-auto-rows: 250px;
    }
</style>

<body>
<div id="throbber" style="display:none; min-height:120px;"></div>
<div id="noty-holder"></div>


<div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-bars" aria-hidden="true" style="color: white;"></i>
            </button>
            <div class="navbar-brand">
            </div>
        </div>

        <form action="" class="navbar-form navbar-left">
            <div class="input-group">
                <div class="input-group-btn">
                    <button class="btn  search-btn-icon">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </button>
                </div>
                <input type="Search" placeholder="Search..." class="form-control-serch search-box"/>
            </div>
        </form>

        <!-- Top Menu Items -->
        <div class="items">
            <ul class="nav navbar-right top-nav">
                <li class="editpro">
                    <i class="fasett fa-cog" aria-hidden="true" class="menu-button" id="menu-button"></i>
                    <h5 class="pull-left login-person-head" id="user"></h5>
                </li>
            </ul>
        </div>

        <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
        <div class="collapse navbar-collapse navbar-ex1-collapse"
             style="background-color: #616060; border:1px solid #616060;">
            <ul class="nav navbar-nav side-nav">
                <a href="#"><img class="logostyle"
                                 src="../upload/avatar/1.png"
                                 alt="LOGO" style="border-radius: 50%"></a>
                <li>
                    <a class="active" href="./personnel_management.html" data-toggle="collapse"
                       data-target="#submenu-1"><i class="fa fa-home"
                                                   aria-hidden="true"></i>
                          <span style="color:white;">  Home </span></a>
                </li>
                <li>
                    <a class="#" href="./class.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-user-o"
                            aria-hidden="true"></i>  
                        <span style="color:white;">  课程管理 </span></a>
                </li>
                <li>
                    <a class="#" href="./teacher.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-calendar"
                            aria-hidden="true"></i>  
                        <span style="color:white;"> 教师 </span></a>
                </li>
                <li>
                    <a class="#" href="./student.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-envelope"
                            aria-hidden="true"></i> 
                        <span style="color:white;"> 学生 </span></a>
                </li>
                <li>
                    <a class="#" href="./employee.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-envelope"
                            aria-hidden="true"></i> 
                        <span style="color:white;"> 员工 </span></a>
                </li>

                <li>
                    <a class="#" href="./setting.html" data-toggle=" collapse" data-target="#submenu-1"><i
                            class="fa fa-cogs"
                            aria-hidden="true"></i>  
                        <span style="color:white;"> Settings </span></a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </nav>

    <div class="container-fluid">
        <div class="row text-center">
            <div class="col-md-12 ">
                <h1> Welcome To Home</h1>
                <div id="course_list" class="bookList">
                    <div id="employee">
                        <br>
                        <div>员工分布</div>
                    </div>
                    <div id="course">
                        <br>
                        <div>课程分布</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div><!-- /#wrapper -->
</body>
<script>
    var width = 400;
    var height = 400;
    let user = sessionStorage.getItem("user");
    window.onload = function () {
        document.getElementById("user").innerHTML = "Welcome " + user;
        let course_ctype_num = [];

        let employee_num = [{type: "管理员", num: 0}, {type: "老师", num: 0}, {type: "学生", num: 0}];
        $.ajax({
            url: 'http://localhost:3000/user/getAll',
            type: 'get',
            datatype: 'jsonp',
            crossDomain: true,
            success: function (data, status, xhr) {
                for (let i = 0; i < data.result.length; i++) {
                    if (data.result[i].identity === 1) {
                        employee_num[0].num++;
                    } else if (data.result[i].identity === 2) {
                        employee_num[1].num++;
                    } else {
                        employee_num[2].num++;
                    }
                }

                //员工
                var svg = d3.select("#employee")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", height);

                var pie = d3.layout.pie().value(function (d) {
                    return d.num;
                });

                var outerRadius = 150;	//外半径
                var innerRadius = 0;	//内半径，为0则中间没有空白

                var arc = d3.svg.arc()	//弧生成器
                        .innerRadius(innerRadius)	//设置内半径
                        .outerRadius(outerRadius);	//设置外半径

                var color = d3.scale.category10();

                var arcs = svg.selectAll("g")
                        .data(pie(employee_num))
                        .enter()
                        .append("g")
                        .attr("transform", "translate(" + (width / 2) + "," + (width / 2) + ")");

                arcs.append("path")
                        .attr("fill", function (d, i) {
                            return color(i);
                        })
                        .attr("d", function (d) {
                            return arc(d);
                        });

                arcs.append("text")
                        .attr("transform", function (d) {
                            return "translate(" + arc.centroid(d) + ")";
                        })
                        .attr("text-anchor", "middle")
                        .text(function (d) {
                            return d.data.type;
                        });
            }
        });


        var CountObj = function (character) {
            this.num = 1;
            this.name = character;
            return this;
        };

        function createCompareFunction(propertyName) {

            return function (object1, object2) {
                var value1 = object1.propertyName;
                var value2 = object2.propertyName;

                if (value1 < value2) {
                    return -1;
                } else if (value1 > value2) {
                    return 1;
                } else {
                    return 0;
                }
            }
        }

        $.ajax({
            url: 'http://localhost:3000/course/getAll',
            type: 'get',
            datatype: 'jsonp',
            crossDomain: true,
            success: function (data, status, xhr) {

                if (status === "success") {
                    console.log("code" > "computer");
                    data.result.sort(createCompareFunction("ctype"));
                    var arrayObj = null,
                            countArrayObj = null,
                            arrayLength = 0,
                            obj;
                    for (let i = 0; i < data.result.length; i++) {
                        arrayObj = data.result[i].ctype;
                        arrayLength = course_ctype_num.length;
                        if (arrayLength > 0) {
                            countArrayObj = course_ctype_num[arrayLength - 1];
                            if (countArrayObj.name === arrayObj) {
                                countArrayObj.num++;
                            } else {
                                course_ctype_num.push(new CountObj(arrayObj));
                            }
                        } else {
                            course_ctype_num.push(new CountObj(arrayObj));
                        }
                    }

                    console.log(course_ctype_num)

                    var svg = d3.select("#course")
                            .append("svg")
                            .attr("width", width)
                            .attr("height", height);

                    var pie = d3.layout.pie().value(function (d) {
                        return d.num;
                    });

                    var outerRadius = 150;	//外半径
                    var innerRadius = 50;	//内半径，为0则中间没有空白

                    var arc = d3.svg.arc()	//弧生成器
                            .innerRadius(innerRadius)	//设置内半径
                            .outerRadius(outerRadius);	//设置外半径

                    var color = d3.scale.category10();

                    var arcs = svg.selectAll("g")
                            .data(pie(course_ctype_num))
                            .enter()
                            .append("g")
                            .attr("transform", "translate(" + (width / 2) + "," + (width / 2) + ")");

                    arcs.append("path")
                            .attr("fill", function (d, i) {
                                return color(i);
                            })
                            .attr("d", function (d) {
                                return arc(d);
                            });

                    arcs.append("text")
                            .attr("transform", function (d) {
                                return "translate(" + arc.centroid(d) + ")";
                            })
                            .attr("text-anchor", "middle")
                            .text(function (d) {
                                return d.data.name;
                            });
                }
            }
        });
    };
</script>
</html>