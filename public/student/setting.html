<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>setting</title>
</head>
<style>
    body {
        font-family: 'lato' !important;
        background-color: #eee;
    }

    /*navbar start*/

    @media (min-width: 768px) {

        body {
            margin-top: 50px;
        }
    }

    #wrapper {
        padding-left: 0;
    }

    #page-wrapper {
        width: 100%;
        padding: 0;
    }

    /* Side Navigation */

    @media (min-width: 768px) {

        #wrapper {
            padding-left: 225px;
        }

        #page-wrapper {
            padding: 2px 10px;
        }

        .side-nav {
            position: fixed;
            top: -21px;
            left: 225px;
            width: 225px;
            margin-left: -225px;
            border: none;
            border-radius: 0;
            overflow-y: auto;
            background-color: #313131;
            bottom: 0;
            overflow-x: hidden;
            padding-bottom: 40px;
            margin-top: 20px;
        }

        .side-nav > li > a {
            width: 225px;
            border-bottom: 1px solid #6C7278;
            margin-top: 15px;
        }
    }

    .navbar-inverse .navbar-collapse, .navbar-inverse .navbar-form {
        border-color: #616060 !important;
    }

    .navbar-ex1-collapse {
        background-color: #fff;
    }

    .logostyle {
        width: 50%;
        max-width: 186px;
        margin-top: 10px;
        margin-left: 55px;
    }

    .navbar-inverse .navbar-nav > li > .active {
        border-left: 3px solid white;
    }

    .nav > li > a {
        position: relative;
        display: block;
        padding: 12px 15px;
        margin-right: 15px;
    }

    .nav .open > a, .nav .open > a:focus, .nav .open > a:hover {
        background-color: transparent;
        border-color: white;
    }

    a {
        color: white !important;
        text-decoration: none;
    }

    .form-control-serch {
        height: 32px;
        padding: 0px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        color: #555;
        background-color: #fff;
        background-image: none;
        border: 1px solid #ccc;
        border-radius: 0px 22px 22px 0px;
        box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
        transition: border-color ease-in-out .15s, box-shadow ease-in-out .15s;
    }

    .search-btn-icon {
        background-color: #fff;
        border: 1px solid #E8E8E8;
        border-right: transparent !important;
        border-top-left-radius: 30px;
        border-bottom-left-radius: 30px;
        height: 32px;
        margin-left: 200px;
    }

    .search-box {
        border-left: transparent !important;
        border-top-right-radius: 30px;
        border-bottom-right-radius: 30px;
        border: 1px solid #E8E8E8;
        height: 32px;
    }

    .fasett {
        display: inline-block;
        font: normal normal normal 14px/1 FontAwesome;
        font-size: 25px;
        text-rendering: auto;
        color: white;
        margin-top: 10px;
        margin-right: 30px;
        cursor: pointer;
    }

    a:hover {
        background-color: transparent !important;
    }

    .editpro h5 {
        margin-right: 15px;
        margin-top: 15px;
        color: white;
    }

    /*navbar end*/
    @media screen and (max-device-width: 640px) {

        .search-btn-icon {
            background-color: #fff;
            border: 1px solid #E8E8E8;
            border-right: transparent !important;
            border-top-left-radius: 30px;
            border-bottom-left-radius: 30px;
            height: 32px;
            margin-left: 115px;
        }

        .editpro h5 {
            margin-right: 12px;
            margin-top: 15px;
            color: white;
            margin-left: 158px;
        }

        .dashhead h1 {
            margin-top: 180px;
        }
    }

    .course_style {
        background: white;
        margin-top: 50px;
        width: 900px;;
        margin-left: auto;
        margin-right: auto;
    }

    #list_info {
        margin-left: 50px;
    }

    #jiben_1, #zhanghu_1, #updatepass_1, #evaluation_1, #avatar_1 {
        margin-left: 50px;
    }

</style>
<script>
    let users;
    let uid = sessionStorage.getItem("id");
    let user = sessionStorage.getItem("user");
    let savatar = sessionStorage.getItem("avatar");

    window.onload = function () {
        document.getElementById("user").innerHTML = "Welcome " + user;
        $(".logostyle").attr("src", savatar);

        $.ajax({
            url: 'http://localhost:3000/student/searchStudentBySid',
            type: 'post',
            datatype: 'jsonp',
            data: {
                sid: uid
            },
            crossDomain: true,
            success: function (data, status, xhr) {
                users = data;
                if (status === "success") {
                    var jiben = document.getElementById("jiben_1");
                    var zhanghu = document.getElementById("zhanghu_1");
                    var updatepass = document.getElementById("updatepass_1");
                    jiben.innerHTML = '<br>姓名：' + data.result[0].sname +
                            '<br><br>性别：' + data.result[0].ssex +
                            '<br><br>年龄：' + data.result[0].sage +
//                            '<br><br>出生日期：' + data.result[0].birth +
//                            '<br><br>联系方式：' + data.result[0].tel +
                            '<br><br>手机：' + data.result[0].snumber +
                            '<br><br>邮箱：' + data.result[0].semail +
                            '<br><br>地址：' + data.result[0].saddress + '<br><br>' +
                            '&nbsp;&nbsp;&nbsp;<button class="btn" id="editStudent" onclick=editStudent()>修改</button>';

                    zhanghu.innerHTML = '<br>用户ID：' + data.result[0].sid +
                            '<br><br>用户名：' + data.result[0].username +
                            '<br><br>身份：学生' + '<br><br>';

                    updatepass.innerHTML = '<br>密码：' + data.result[0].password + '&nbsp;&nbsp;&nbsp;<button class="btn" id="update" onclick=updatepassword()>修改</button>'

                }
            }
        });


        $.ajax({
            url: 'http://localhost:3000/student/getEvalulation',
            type: 'post',
            datatype: 'jsonp',
            data: {
                sid: uid
            },
            crossDomain: true,
            success: function (data, status, xhr) {
                console.log(data);
                if (status === "success" && data.status === 1) {
                    var evaluation = "";
                    for (let i = 0; i < data.result.length; i++) {
                        evaluation += '课程名称：' + data.result[i].cname + '<br><br>老师：' + data.result[i].tname + '<br><br>' +
                                '评价：' + data.result[i].evaluation + '<br><br>学习建议：' + data.result[i].suggestion + '<hr>';
                    }
                    document.getElementById("evaluation_1").innerHTML = evaluation;
                }
            }
        });

        var jiben_1 = document.getElementById("jiben_1");
        var jiben = document.getElementById("jiben");
        jiben.onclick = function () {
            if (jiben_1.style.display == "none") {
                jiben_1.style.display = "block";
            } else {
                jiben_1.style.display = "none";
            }
        };

        var zhanghu_1 = document.getElementById("zhanghu_1");
        var zhanghu = document.getElementById("zhanghu");
        zhanghu.onclick = function () {
            if (zhanghu_1.style.display == "none") {
                zhanghu_1.style.display = "block";
            } else {
                zhanghu_1.style.display = "none";
            }
        };

        var updatepass_1 = document.getElementById("updatepass_1");
        var updatepass = document.getElementById("updatepass");
        updatepass.onclick = function () {
            if (updatepass_1.style.display == "none") {
                updatepass_1.style.display = "block";
            } else {
                updatepass_1.style.display = "none";
            }
        }

        var avatar_1 = document.getElementById("avatar_1");
        var avatar = document.getElementById("avatar");
        avatar.onclick = function () {
            if (avatar_1.style.display == "none") {
                avatar_1.style.display = "block";
            } else {
                avatar_1.style.display = "none";
            }
        }
        var evaluation_1 = document.getElementById("evaluation_1");
        var evaluation = document.getElementById("evaluation");
        evaluation.onclick = function () {
            if (evaluation_1.style.display == "none") {
                evaluation_1.style.display = "block";
            } else {
                evaluation_1.style.display = "none";
            }
        }
    }

    function updatepassword() {
        document.getElementById("updatepass_1").innerHTML = '<input type="text" id="pass" value="" placeholder="请输入新密码" > ' +
                '&nbsp;&nbsp;&nbsp;<button class="btn" onclick=editpassword()>修改</button>'
    }

    var password;

    function editpassword() {
        uid = users.result[0].uid;
        password = document.getElementById("pass").value;
        $.ajax({
            url: 'http://localhost:3000/user/updatepass',
            type: 'post',
            datatype: 'jsonp',
            crossDomain: true,
            data: {
                uid,
                password
            },
            success: function (data, status, xhr) {
                console.log(data);
                if (status === "success" && data.status === 1) {
                    history.go(0)
                } else {
                    document.getElementById("warning").innerHTML = "修改失败！"
                }
            }
        });
    }

    function editStudent() {
        document.getElementById("jiben_1").innerHTML = '<br>姓名：' + users.result[0].sname +
                '<br><br>性别：' + users.result[0].ssex +
                '<br><br>年龄：' + users.result[0].sage +
                '<br><br>手机：<input type="text" id="snumber" value="' + users.result[0].snumber + '"> ' +
                '<br><br>邮箱：<input type="text" id="semail" value="' + users.result[0].semail + '"> ' +
                '<br><br>地址：<input type="text" id="saddress" value="' + users.result[0].saddress + '"> ' + '<br><br>' +
                '&nbsp;&nbsp;&nbsp;<button class="btn" onclick=updateStudent()>修改</button>'
    }

    function updateStudent() {
        var sid = uid;
        var sname = users.result[0].sname;
        var sage = users.result[0].sage;
        var ssex = users.result[0].ssex;
        var semail = document.getElementById("semail").value;
        var snumber = document.getElementById("snumber").value;
        var saddress = document.getElementById("saddress").value;

        $.ajax({
            url: 'http://localhost:3000/student/updateStudent',
            type: 'post',
            datatype: 'jsonp',
            crossDomain: true,
            data: {
                sid: sid,
                sname: sname,
                sage: sage,
                ssex: ssex,
                semail: semail,
                saddress: saddress,
                snumber: snumber
            },
            success: function (data, status, xhr) {
                console.log(data);
                if (status === "success" && data.result === 1) {
                    history.go(0)
                } else {
                    document.getElementById("warning").innerHTML = "您输入的信息有误"
                }
            }
        });

    }

    function uploadImage() {
        var formData = new FormData($("#frmUploadFile")[0]);

        formData.append("sid", uid);

        console.log(formData);

        $.ajax({
            url: 'http://localhost:3000/student/updateAvatar',
            type: 'POST',
            datatype: 'jsonp',
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (data) {
                if (200 === data.code) {
                    $("#imgShow").attr('src', data.filepath);
                    $("#spanMessage").html("上传成功");
                    sessionStorage.setItem("avatar", data.filepath)
                    history.go(0)
                } else {
                    $("#spanMessage").html("上传失败");
                }
                console.log('imgUploader upload success, data:', data);
            },
            error: function (err) {
                console.log("err", err);
                $("#spanMessage").html("与服务器通信发生错误");
            }
        });
    }

</script>
<body>
<div id="throbber" style="display:none; min-height:120px;"></div>
<div id="noty-holder"></div>

<div id="wrapper">

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <i class="fa fa-bars" aria-hidden="true" style="color: white;"></i>
            </button>
            <div class="navbar-brand">
            </div>
        </div>

        <form action="" class="navbar-form navbar-left">
            <div class="input-group">
                <div class="input-group-btn">
                    <button class="btn  search-btn-icon">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </button>
                </div>
                <input type="Search" placeholder="Search..." class="form-control-serch search-box"/>
            </div>
        </form>

        <!-- Top Menu Items -->
        <div class="items">
            <ul class="nav navbar-right top-nav">
                <li class="editpro">
                    <i class="fasett fa-cog" aria-hidden="true" class="menu-button" id="menu-button"></i>
                    <h5 class="pull-left login-person-head" id="user"></h5>
                </li>
            </ul>
        </div>

        <!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
        <div class="collapse navbar-collapse navbar-ex1-collapse"
             style="background-color: #616060; border:1px solid #616060;">
            <ul class="nav navbar-nav side-nav">
                <a href="#"><img class="logostyle"
                                 src=""
                                 alt="LOGO" style="border-radius: 50%"></a>
                <li>
                    <a class="#" href="./student_home.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-home"
                            aria-hidden="true"></i>
                          <span style="color:white;">  Home </span></a>
                </li>
                <li>
                    <a class="#" href="./myCourse.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-user-o"
                            aria-hidden="true"></i>  
                        <span style="color:white;">  我的课程 </span></a>
                </li>
                <li>
                    <a class="#" href="./orderCourse.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-calendar"
                            aria-hidden="true"></i>  
                        <span style="color:white;"> 预约课程 </span></a>
                </li>
                <li>
                    <a class="#" href="./finishCourse.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-calendar"
                            aria-hidden="true"></i>  
                        <span style="color:white;"> 已结束课程 </span></a>
                </li>
                <li>
                    <a class="active" href="./setting.html" data-toggle="collapse" data-target="#submenu-1"><i
                            class="fa fa-envelope"
                            aria-hidden="true"></i> 
                        <span style="color:white;"> setting </span></a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </nav>

    <div class="container-fluid">
        <div class="row course_style">
            <div class="col-md-12 dashhead">
                <h1 class="text-center"> Welcome To setting</h1>
                <div id="list_info">
                    <h3 id="jiben">基本信息</h3>
                    <div id="jiben_1" style="display:none">1111</div>

                    <h3 id="zhanghu">账户信息</h3>
                    <div id="zhanghu_1" style="display:none">2222</div>

                    <h3 id="evaluation">老师评价</h3>
                    <div id="evaluation_1" style="display:none">暂时还没有老师对你评价</div>

                    <h3 id="avatar">修改头像</h3>
                    <div id="avatar_1" style="display:none">
                        <form class="form-horizontal" enctype='multipart/form-data' method='post' action='javascript:;'
                              role="form"
                              id="frmUploadFile">
                            <label class="control-label col-sm-2">上传选择</label>
                            <input type="file" name="files" class=""/>

                            <button class="btn btn-primary" onClick="uploadImage()">上传</button>
                            <span class="help-inline" id="spanMessage">选择文件，并上传</span>
                        </form>
                    </div>

                    <h3 id="updatepass">修改密码</h3>
                    <div id="updatepass_1" style="display:none">2222</div>
                    <span id="warning" style="color: red;;"></span>
                </div>

            </div>
        </div>
    </div>

</div><!-- /#wrapper -->
</body>
</html>